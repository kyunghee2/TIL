## 2019.10.30

## Database

- ORM 이용하여 데이터 엑세스

```cmd
student@M150119 MINGW64 /c/TIL/05_django (master)
$ source ~/venv/Scripts/activate
(venv)
student@M150119 MINGW64 /c/TIL/05_django (master)
$ cd 02_django_orm_crud/
(venv)
student@M150119 MINGW64 /c/TIL/05_django/02_django_orm_crud (master)
$ django-admin startproject config .
(venv)
student@M150119 MINGW64 /c/TIL/05_django/02_django_orm_crud (master)
$ python manage.py startapp articles
```

#### 1. Model
- 장고 MTV 패턴
	- Model
		- 특정한 데이터의 구조(모양)에 대한 정보를 가지고 있다
		- 하나의 모델 클래스는 실제 DB에는 하나의 테이블로 매핑된다
		- 컬럼에 대한 정보, 해당 데이터에 대한 정보를 정의하는 곳
	- Template
	- View
#### Model 로직
- 데이터베이스 컬럼(열)과 어떠한 타입으로 정의할 것인지에 대한 정보를 `django.db.models` 라는 곳에서 상속받아서 정의한다
- 모든 필드들은 `NOT NULL` 조건이 붙는다.
- 각각의 클래스 변수는 데이터베이스 필드를 나타낸다.
- Django 모델 - 마이그레이션 파일(작업지시서) - 데이터베이스
##### 실습
- models.py
```python
from django.db import models

# django.db.models.Model 클래스를 상속받아서 모델을 정의함
class Article(models.Model):
    # id(PK)는 인스턴스 생성과 함께 자동으로 부여된다

    # CharField에서 max_length는 필수인자
    # 장고 내부에서 데이터 유효성 검증을 할 때 사용
    title = models.CharField(max_length=30)
    # 긴 문자열은 TextField 사용
    context = models.TextField()
    # auto_now_add=True : 인스턴스 최초 생성 시각
    created_at = models.DateTimeField(auto_now_add=True)
    #auto_now=True : 인스턴스 최종 수정 시각 (업데이트됨)
    # updated_at = models.DateTimeField(auto_now=True)

```

- makemigrations
	- 실제 데이터베이스 테이블을 만들기 전에 설계도를 그려보는 작업
	- migrations 폴더에서 확인해볼수 있다. (0001_initial.py...)
- 마이그레이션 파일 생성
```cmd
#/05_django/02_django_orm_crud (master)
$ python manage.py makemigrations
...
#실행 결과
Migrations for 'articles':
  articles\migrations\0001_initial.py
    - Create model Article
(venv)
```
- sqlmigrate
	- 데이터베이스에 실제로 반영하기 전에 SQL문으로 바뀐 모습을 확인
```cmd
#05_django/02_django_orm_crud 
$ python manage.py sqlmigrate articles 0001
```
- showmigrations
	- migration 설계도를 작성했는데, 이설계도가 실제 DB에 반영되었는지 확인
```cmd
# 05_django/02_django_orm_crud 위치에서
$ python manage.py showmigrations
```
- migrate 
	- makemigrations로 만든 설계도를 실제 데이터베이스(sqlite3)에 반영한다
	- 모델의 변경사항과 
```cmd
# 05_django/02_django_orm_crud 위치에서
$ python manage.py migrate
```

#### 2. ORM - CRUD
